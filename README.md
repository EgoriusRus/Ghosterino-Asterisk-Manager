# Asterisk Manager - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è Asterisk

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è IP-—Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏ –Ω–∞ –±–∞–∑–µ Asterisk PBX —Å REST API –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤ –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd asterisk-manager
make demo
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
- üåê REST API: http://localhost:8080
- üìä 10 –ø—Ä–æ—Ñ–∏–ª–µ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –±–∞–∑–µ
- üìÅ –ì–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ Asterisk –≤ `backend/results/`

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üåê **REST API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ –ª–æ–∫–∞—Ü–∏—è–º–∏
- üìä –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ PostgreSQL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è IP-—Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (Yealink T27G, T23G, Fanvil, Cisco)
- üìû –°–æ–∑–¥–∞–Ω–∏–µ SIP-–∫–æ–Ω—Ñ–∏–≥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üéØ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–ø–ª–∞–Ω–æ–≤ Asterisk
- üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cisco –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- üíæ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL —á–µ—Ä–µ–∑ GORM
- üå± Database seeder –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend:** Go 1.24
- **Web Framework:** Fiber v2
- **Database:** PostgreSQL 16 (—Å network —Ç–∏–ø–∞–º–∏: inet, cidr, macaddr)
- **ORM:** GORM
- **Deployment:** Docker, Docker Compose

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏:

```
backend/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ generator/    # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤ Asterisk
‚îÇ   ‚îî‚îÄ‚îÄ seed/         # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ domain/           # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (Profile, Device, Location)
‚îú‚îÄ‚îÄ repositories/     # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º (–±–µ–∑ GetDB)
‚îú‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤)
‚îú‚îÄ‚îÄ handlers/         # HTTP handlers –¥–ª—è REST API
‚îú‚îÄ‚îÄ main.go           # Fiber REST API —Å–µ—Ä–≤–µ—Ä
‚îî‚îÄ‚îÄ routes.go         # –ú–∞—Ä—à—Ä—É—Ç—ã API
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Go 1.24+ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- Make (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. **–†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤:**
```bash
unzip asterisk-manager.zip
cd asterisk-manager
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –¥–µ–º–æ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:**
```bash
make demo
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- –ü–æ–¥–Ω–∏–º–µ—Ç Docker Compose (PostgreSQL + API)
- –î–æ–∂–¥–µ—Ç—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ó–∞–ø–æ–ª–Ω–∏—Ç –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (seed)
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏ Asterisk

**–ò–ª–∏ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º:**

```bash
# 1. –ü–æ–¥–Ω—è—Ç—å Docker Compose
make up

# 2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
make seed

# 3. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏
make generator

# 4. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make logs

# 5. –û—Å—Ç–∞–Ω–æ–≤–∫–∞
make down
```

### API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É

```
http://localhost:8080
```

## Makefile –∫–æ–º–∞–Ω–¥—ã

### –ö–æ—Ä–Ω–µ–≤–æ–π Makefile (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç)

```bash
make help           # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make demo           # üöÄ –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (Docker + seed + generator)
make up             # –ü–æ–¥–Ω—è—Ç—å Docker Compose
make down           # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker Compose
make restart        # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make logs           # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
make logs-backend   # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ backend
make logs-postgres  # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ postgres
make seed           # –ó–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
make generator      # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤
make build          # –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã
make clean          # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã + volumes + –∫–æ–Ω—Ñ–∏–≥–∏)
make test           # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make status         # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
make api-test       # –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints
make shell-backend  # –í–æ–π—Ç–∏ –≤ shell backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make shell-postgres # –í–æ–π—Ç–∏ –≤ psql –∫–æ–Ω—Å–æ–ª—å
```

### Backend Makefile (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

–î–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ Docker, –∫–æ–≥–¥–∞ PostgreSQL —É–∂–µ –∑–∞–ø—É—â–µ–Ω:

```bash
cd backend

make help          # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make build         # –°–æ–±—Ä–∞—Ç—å API —Å–µ—Ä–≤–µ—Ä (bin/api)
make run           # –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å API —Å–µ—Ä–≤–µ—Ä
make seed          # –ó–∞–ø–æ–ª–Ω–∏—Ç—å –±–∞–∑—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
make generator     # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤
make clean         # –û—á–∏—Å—Ç–∏—Ç—å bin/ –∏ results/
make test          # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
```

## REST API Endpoints

### –ü—Ä–æ—Ñ–∏–ª–∏ (–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)
- `GET /api/profiles` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –ª–æ–∫–∞—Ü–∏–π (JOIN) –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
  - Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - `?page=1` - –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)
    - `?perPage=10` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10, –º–∞–∫—Å–∏–º—É–º: 100)
- `GET /api/profiles/:id` - –û–¥–∏–Ω –ø—Ä–æ—Ñ–∏–ª—å –ø–æ ID
- `POST /api/profiles` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å
- `PUT /api/profiles/:id` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `DELETE /api/profiles/:id` - –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

### –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `GET /api/devices` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `GET /api/devices/:mac` - –û–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ MAC
- `POST /api/devices` - –°–æ–∑–¥–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `PUT /api/devices/:mac` - –û–±–Ω–æ–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- `DELETE /api/devices/:mac` - –£–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### –õ–æ–∫–∞—Ü–∏–∏
- `GET /api/locations` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ª–æ–∫–∞—Ü–∏–π
- `GET /api/locations/:id` - –û–¥–Ω–∞ –ª–æ–∫–∞—Ü–∏—è –ø–æ ID
- `POST /api/locations` - –°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é
- `PUT /api/locations/:id` - –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é
- `DELETE /api/locations/:id` - –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

**–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π):**
```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (10 –∑–∞–ø–∏—Å–µ–π)
curl http://localhost:8080/api/profiles

# –ü–æ–ª—É—á–∏—Ç—å –≤—Ç–æ—Ä—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å 20 –∑–∞–ø–∏—Å—è–º–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
curl "http://localhost:8080/api/profiles?page=2&perPage=20"

# –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π:
{
  "data": [
    {
      "id": 1,
      "name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "email": "ivanov@example.com",
      ...
    }
  ],
  "pagination": {
    "total": 100,
    "page": 2,
    "perPage": 20,
    "pages": 5
  }
}
```

**–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å:**
```bash
curl -X POST http://localhost:8080/api/profiles \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
    "email": "ivanov@example.com",
    "device": "80:5e:c0:11:22:33",
    "locationId": 1,
    "internalNumber": 1234,
    "externalNumber": "123456",
    "ringGroup": 5000,
    "pickupGroup": 10,
    "isActive": true
  }'
```

**–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å:**
```bash
curl -X PUT http://localhost:8080/api/profiles/1 \
  -H "Content-Type: application/json" \
  -d '{"name": "–ù–æ–≤–æ–µ –ò–º—è", "email": "new@example.com"}'
```

**–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å:**
```bash
curl -X DELETE http://localhost:8080/api/profiles/1
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞: sipadmin

**–¢–∞–±–ª–∏—Ü–∞ locations:**
- `id` - Primary Key
- `name` - –ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏
- `server` - IP –∞–¥—Ä–µ—Å SIP —Å–µ—Ä–≤–µ—Ä–∞ (inet)
- `subnet` - –ü–æ–¥—Å–µ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ (cidr)
- `voip_vlan` - VLAN –¥–ª—è VoIP
- `vlan` - VLAN –¥–ª—è LAN

**–¢–∞–±–ª–∏—Ü–∞ devices:**
- `mac` - MAC –∞–¥—Ä–µ—Å (macaddr) - Primary Key
- `device_model` - –ú–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (Yealink T27G, T23G, Fanvil, Cisco)

**–¢–∞–±–ª–∏—Ü–∞ profiles:**
- `id` - Primary Key
- `name` - –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- `email` - Email
- `device` - MAC –∞–¥—Ä–µ—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (macaddr)
- `location_id` - FK –Ω–∞ locations
- `internal_number` - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `external_number` - –í–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä
- `ring_group` - –ì—Ä—É–ø–ø–∞ –≤—Ö–æ–¥—è—â–∏—Ö
- `pickup_group` - –ì—Ä—É–ø–ø–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞
- `is_active` - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (—á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π **–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç GetDB()**, –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã:

```go
// –ë–∞–∑–æ–≤—ã–µ CRUD
repos.Save(&profile)           // –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
repos.Delete(&profile)         // –£–¥–∞–ª–µ–Ω–∏–µ
repos.FindAll(&profiles)       // –í—Å–µ –∑–∞–ø–∏—Å–∏
repos.FindByID(&profile, id)   // –ü–æ ID
repos.FindOne(&device, "mac = ?", mac)  // –ü–æ —É—Å–ª–æ–≤–∏—é

// –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å JOIN
repos.FindProfilesWithLocations(isActive, pagination)  // –ü—Ä–æ—Ñ–∏–ª–∏ + –ª–æ–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ LEFT JOIN —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
repos.Exec(sql)                // Raw SQL (—Ç–æ–ª—å–∫–æ –¥–ª—è seed/migrations)

// –ü–∞–≥–∏–Ω–∞—Ü–∏—è
pagination := &domain.PaginationInput{Page: 1, PerPage: 10}
profiles, total, err := repos.FindProfilesWithLocations(nil, pagination)
```

### Database Seeder

Seed —Å–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
- 6 –ª–æ–∫–∞—Ü–∏–π (Zags, Sov, Nad3, Ubil1, Ind4, Len15v)
- 10 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å MAC –∞–¥—Ä–µ—Å–∞–º–∏
- 10 –ø—Ä–æ—Ñ–∏–ª–µ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```bash
cd backend
make seed
```

## –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤ Asterisk

–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ PostgreSQL –∏ —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏:

```bash
cd backend
make generator
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `backend/results/`:

### –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**tftpboot/** - –∫–æ–Ω—Ñ–∏–≥–∏ –¥–ª—è –∞–≤—Ç–æ–ø—Ä–æ–≤–∏–∂–∏–Ω–∏–Ω–≥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤:
- `805ec0b4427c.cfg` - –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è Yealink T23G
- `805ec018abac.cfg` - –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è Yealink T27G
- –ò —Ç.–¥. (–ø–æ MAC –∞–¥—Ä–µ—Å—É)

**UsersConf/** - SIP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- `User1119.conf` - SIP peer –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ 1119
- `User1058.conf` - SIP peer –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ 1058
- –ò —Ç.–¥.

**ExtConf/** - —Ñ–∞–π–ª—ã –¥–∏–∞–ª–ø–ª–∞–Ω–∞ Asterisk:
- `ExtensionsCID.conf` - CallerID –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- `ExtensionsRG.conf` - Ring groups
- `ExtensionsRGCFG.conf` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ring groups
- `ExtensionsVMCFG.conf` - –ì–æ–ª–æ—Å–æ–≤–æ–µ –º–µ–Ω—é –∏ —Ñ–∞–∫—Å
- `ExtensionsOut.conf` - –ò—Å—Ö–æ–¥—è—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
- `ExtensionsDP.conf` - Dialplan –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
- `ExtensionsTrunkZags.conf` - Trunk –¥–ª—è –ó–ê–ì–°
- `ExtensionsTrankAdm.conf` - Trunk –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏

**CiscoConf.txt** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è dial-peer –¥–ª—è Cisco —Ä–æ—É—Ç–µ—Ä–∞

## Production Deployment

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ: **[docs/DEPLOYMENT.md](docs/DEPLOYMENT.md)**

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# 1. –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
unzip asterisk-manager.zip
sudo mv asterisk-manager /opt/
cd /opt/asterisk-manager

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.prod.example .env.prod
nano .env.prod  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏!

# 3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π Asterisk
sudo mkdir -p /srv/tftp /etc/asterisk/users /etc/asterisk/extensions

# 4. –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º–µ
make prod-up

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
make prod-logs
```

### Production –∫–æ–º–∞–Ω–¥—ã

```bash
make prod-up       # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–∏—Å—ã
make prod-down     # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–∏—Å—ã
make prod-restart  # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make prod-logs     # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏
make prod-build    # –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
make backup        # –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –ë–î
```

### –û—Ç–ª–∏—á–∏—è –æ—Ç dev –æ–∫—Ä—É–∂–µ–Ω–∏—è

**docker-compose.prod.yml**:
- PostgreSQL **–±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –ø–æ—Ä—Ç–∞** (—Ç–æ–ª—å–∫–æ –¥–ª—è backend)
- Backend bind –Ω–∞ **127.0.0.1** (–¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ reverse proxy)
- Volume mounts –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Asterisk
- **restart: always** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –õ–∏–º–∏—Ç—ã –ª–æ–≥–æ–≤ (10MB, 3 —Ñ–∞–π–ª–∞)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è**:
- Nginx reverse proxy —Å SSL
- Firewall (—Ç–æ–ª—å–∫–æ 80, 443, 22)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã —á–µ—Ä–µ–∑ cron
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL:**
```bash
docker compose up -d postgres
```

2. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –±–∞–∑—É:**
```bash
cd backend
make seed
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ API:**
```bash
make run
# –∏–ª–∏
go run main.go routes.go
```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä:**
```bash
make generator
```

## Docker

### Healthchecks

PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç healthcheck –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:
```yaml
healthcheck:
  test: ["CMD-READY", "pg_isready"]
  interval: 10s
  timeout: 5s
  retries: 5
```

Backend —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL:
```yaml
depends_on:
  postgres:
    condition: service_healthy
```

### Multi-stage build

Backend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ multi-stage Docker build –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞:
- Builder stage: Go 1.24 Alpine
- Runtime stage: Alpine —Å ca-certificates

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------|----------|--------------|
| `DB_HOST` | –•–æ—Å—Ç PostgreSQL | `localhost` |
| `DB_PORT` | –ü–æ—Ä—Ç PostgreSQL | `5432` |
| `DB_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î | `postgres` |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å –ë–î | `postgres` |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `asterisk_manager` |
| `APP_PORT` | –ü–æ—Ä—Ç API —Å–µ—Ä–≤–µ—Ä–∞ | `8080` |
| `APP_VERSION` | –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | `dev` |

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```go
repos := repositories.InitRepos(connStr)
repos.MigrateDB()  // –°–æ–∑–¥–∞–µ—Ç schema + —Ç–∞–±–ª–∏—Ü—ã + –∏–Ω–¥–µ–∫—Å—ã
```

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:        10
  –ê–∫—Ç–∏–≤–Ω—ã—Ö:             10
  –¢–µ–ª–µ—Ñ–æ–Ω–æ–≤ T27G:       7
  –¢–µ–ª–µ—Ñ–æ–Ω–æ–≤ T23G:       1
  –¢–µ–ª–µ—Ñ–æ–Ω–æ–≤ Fanvil:     0
  Cisco/Fax —É—Å—Ç—Ä–æ–π—Å—Ç–≤:  2
  –° MAC –∞–¥—Ä–µ—Å–∞–º–∏:       9
  –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ:     0
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
cd backend
go test ./...
```

### –õ–∏–Ω—Ç–∏–Ω–≥
```bash
go vet ./...
```

### –°–±–æ—Ä–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
```bash
cd backend
CGO_ENABLED=0 go build -o bin/asterisk-api main.go routes.go
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

- ‚úÖ **–ù–µ—Ç GetDB()** - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î
- ‚úÖ **–ù–µ—Ç Preload** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —è–≤–Ω—ã–µ JOIN –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ **–ù–µ—Ç foreign key –≤ –º–æ–¥–µ–ª—è—Ö** - —Å–≤—è–∑–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ repository
- ‚úÖ **DTO –¥–ª—è JOIN** - ProfileWithLocation –¥–ª—è joined –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —á–µ—Ä–µ–∑ Fiber ErrorHandler
- ‚úÖ **camelCase –≤ JSON** - –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å API

### –¢–∏–ø—ã PostgreSQL

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–∏–ø—ã PostgreSQL:
- `inet` - IP –∞–¥—Ä–µ—Å–∞ (10.16.0.102)
- `cidr` - –°–µ—Ç–∏ (10.1.191.0/26)
- `macaddr` - MAC –∞–¥—Ä–µ—Å–∞ (80:5e:c0:b4:42:7c)

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
